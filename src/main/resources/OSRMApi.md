# OSRM API — описание

HTTP API **OSRM (Open Source Routing Machine)** используется для построения маршрутов, матриц расстояний, map-matching и вспомогательных задач навигации.

Базовый URL (пример публичного сервера):

```
http://router.project-osrm.org
```

---

## Общая структура запросов

Все HTTP-запросы OSRM имеют следующую структуру:

```
/{service}/{version}/{profile}/{coordinates}[.{format}]?option=value&option=value
```

### Параметры пути

| Параметр      | Описание                                                            |
| ------------- | ------------------------------------------------------------------- |
| `service`     | Тип сервиса: `route`, `nearest`, `table`, `match`, `trip`, `tile`   |
| `version`     | Версия API. Всегда `v1` для OSRM 5.x                                |
| `profile`     | Профиль передвижения: `driving`, `bike`, `foot` (зависит от сборки) |
| `coordinates` | Строка координат `{lon},{lat};{lon},{lat}` или `polyline(...)`      |
| `format`      | Формат ответа. Поддерживается только `json` (по умолчанию)          |

### Формат координат

```
{longitude},{latitude};{longitude},{latitude}
```

или

```
polyline({encoded_polyline})
```

Polyline использует формат Google Polyline (precision 5 по умолчанию).

---

## Общие query-параметры

Некоторые параметры могут задаваться **для каждой точки** через `;`.

| Параметр   | Формат            | Описание                          |
| ---------- | ----------------- | --------------------------------- |
| `bearings` | `{value},{range}` | Ограничение направления (градусы) |
| `radiuses` | `{radius}`        | Радиус поиска в метрах            |
| `hints`    | `{hint}`          | Хинт из предыдущих запросов       |

Пример:

```
bearings=0,20;;90,30
```

Количество элементов должно **строго совпадать** с количеством координат.

---

## Коды ответов

Каждый ответ содержит поле `code`:

| Код              | Описание                           |
| ---------------- | ---------------------------------- |
| `Ok`             | Успешно                            |
| `InvalidUrl`     | Некорректный URL                   |
| `InvalidService` | Неизвестный сервис                 |
| `InvalidVersion` | Неверная версия API                |
| `InvalidOptions` | Некорректные параметры             |
| `InvalidQuery`   | Ошибка синтаксиса                  |
| `InvalidValue`   | Недопустимые значения              |
| `NoSegment`      | Координата не привязалась к дороге |
| `TooBig`         | Превышен лимит запроса             |

При ошибке HTTP статус = **400**, при успехе = **200**.

---

## Nearest Service

### `GET /nearest/v1/{profile}/{coordinates}`

Привязывает точку к дорожной сети и возвращает ближайшие сегменты.

**Поддерживается только одна координата.**

#### Параметры

| Параметр | Тип     | Описание                                    |
| -------- | ------- | ------------------------------------------- |
| `number` | integer | Количество ближайших точек (по умолчанию 1) |

#### Ответ

```json
{
  "code": "Ok",
  "waypoints": [
    {
      "name": "Friedrichstraße",
      "location": [13.388799, 52.517033],
      "distance": 4.15,
      "hint": "..."
    }
  ]
}
```

---

## Route Service

### `GET /route/v1/{profile}/{coordinates}`

Строит маршрут между точками в указанном порядке.

#### Параметры

| Параметр       | Значения                           | Описание                |
| -------------- | ---------------------------------- | ----------------------- |
| `alternatives` | `true / false`                     | Альтернативные маршруты |
| `steps`        | `true / false`                     | Пошаговые инструкции    |
| `geometries`   | `polyline`, `polyline6`, `geojson` | Формат геометрии        |
| `overview`     | `full`, `simplified`, `false`      | Общая геометрия         |
| `annotations`  | `true / false`                     | Метаданные сегментов    |

#### Ответ

```json
{
  "code": "Ok",
  "waypoints": [...],
  "routes": [
    {
      "distance": 1200.5,
      "duration": 340.2,
      "geometry": "...",
      "legs": [...]
    }
  ]
}
```

**Ошибки:** `NoRoute`

---

## Table Service

### `GET /table/v1/{profile}/{coordinates}`

Возвращает матрицу времени в пути между точками.

#### Параметры

| Параметр       | Описание                     |
| -------------- | ---------------------------- |
| `sources`      | Индексы источников или `all` |
| `destinations` | Индексы назначений или `all` |

#### Ответ

```json
{
  "code": "Ok",
  "durations": [[0, 120, 300]],
  "sources": [...],
  "destinations": [...]
}
```

**Ошибки:** `NoTable`

---

## Match Service

### `GET /match/v1/{profile}/{coordinates}`

Map-matching: привязка GPS-трека к дорожной сети.

#### Доп. параметры

| Параметр     | Описание                    |
| ------------ | --------------------------- |
| `timestamps` | Временные метки (сек. UNIX) |
| `radiuses`   | Погрешность GPS (м)         |
| `steps`      | Пошаговый маршрут           |

#### Ответ

```json
{
  "code": "Ok",
  "tracepoints": [...],
  "matchings": [...]
}
```

**Ошибки:** `NoMatch`

---

## Trip Service

### `GET /trip/v1/{profile}/{coordinates}`

Решает задачу коммивояжёра (TSP) приближённым методом.

#### Ответ

```json
{
  "code": "Ok",
  "waypoints": [...],
  "trips": [...]
}
```

**Ошибки:** `NoTrips`

---

## Tile Service

### `GET /tile/v1/{profile}/tile({x},{y},{z}).mvt`

Возвращает **Mapbox Vector Tile** с данными дорожного графа.

* Поддерживаются zoom ≥ 12
* Content-Type: `application/x-protobuf`

Используется для дебага и визуализации графа.

---

## Основные объекты ответа

### Waypoint

```json
{
  "name": "Friedrichstraße",
  "location": [13.388799, 52.517033],
  "distance": 4.15,
  "hint": "..."
}
```

### Route

| Поле       | Описание        |
| ---------- | --------------- |
| `distance` | Метры           |
| `duration` | Секунды         |
| `geometry` | Линия маршрута  |
| `legs`     | Массив RouteLeg |

### RouteLeg / RouteStep / Maneuver

Используются для пошаговой навигации (turn-by-turn) и полностью соответствуют HTTP API OSRM.

---

## Примечания

* OSRM **не требует авторизации**
* Ограничения по размеру запросов зависят от конфигурации сервера
* API стабильно, новые поля могут добавляться без смены версии

---

Источник: официальная документация OSRM
