<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Добавить продукт - MythMastery</title>
    <link rel="stylesheet" th:href="@{/css/createUpdatePages.css}">
    <link rel="stylesheet" th:href="@{/css/product.css}">
</head>
<body>
<div class="container">
    <a th:href="@{/products}" class="btn btn-secondary">← Назад к списку</a>
    <h1>Добавить продукт</h1>

    <div th:if="${message}"
         th:class="${'success'.equals(messageType)} ? 'message success' : 'message error'"
         th:text="${message}">
    </div>

    <form method="post" th:action="@{/products/create}" id="productForm">
        <div class="form-row">
            <div class="form-group">
                <label for="name">Название продукта *</label>
                <input type="text" id="name" name="name" required
                       placeholder="Например: Меч Тора, Щит Ахилла">
            </div>

            <div class="form-group">
                <label for="price">Цена (₽) *</label>
                <input type="number" id="price" name="price" required
                       min="0" step="0.01" value="0.00"
                       placeholder="0.00">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="categoryId">Категория *</label>
                <select id="categoryId" name="categoryId" required>
                    <option value="">-- Выберите категорию --</option>
                    <option th:each="category : ${categories}"
                            th:value="${category.id}"
                            th:text="${category.name + ' (' + category.hazard + ', ' + category.rarity + ')'}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label for="mythologyId">Мифология *</label>
                <select id="mythologyId" name="mythologyId" required>
                    <option value="">-- Выберите мифологию --</option>
                    <option th:each="mythology : ${mythologies}"
                            th:value="${mythology.id}"
                            th:text="${mythology.name}">
                    </option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="description">Описание</label>
            <textarea id="description" name="description" rows="3"
                      placeholder="Подробное описание продукта..."></textarea>
        </div>

        <div class="form-group">
            <label for="pic">Ссылка на изображение</label>
            <input type="text" id="pic" name="pic"
                   placeholder="https://example.com/image.jpg"
                   oninput="previewImage(this.value)">
            <div class="image-preview">
                <img id="preview" class="preview-image" alt="Предпросмотр">
            </div>
            <small>Введите URL изображения. Изображение появится в предпросмотре.</small>
        </div>

        <div class="button-group">
            <button type="submit" class="btn btn-primary">Добавить продукт</button>
            <button type="reset" class="btn btn-secondary">Очистить форму</button>
        </div>
    </form>
</div>

<script>
    function previewImage(url) {
        const preview = document.getElementById('preview');
        if (url && url.trim() !== '') {
            preview.src = url;
            preview.style.display = 'block';
            preview.onerror = function() {
                preview.style.display = 'none';
                alert('Не удалось загрузить изображение по указанному URL');
            };
        } else {
            preview.style.display = 'none';
        }
    }
</script>
</body>
</html>