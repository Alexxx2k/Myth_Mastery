<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ - MythMastery</title>
    <link rel="stylesheet" th:href="@{/css/tablesPages.css}">
    <link rel="stylesheet" th:href="@{/css/userOrders.css}">
    <link rel="stylesheet" th:href="@{/css/payOrder.css}">
</head>
<body>
<div class="container">
    <a th:href="@{/}" class="back-link" style="margin-left: 10px;">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    <a th:href="@{/buys/my-orders}" class="back-link" style="margin-left: 10px;">‚Üê –ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>

    <h1>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ #<span th:text="${buyId}"></span></h1>

    <div th:if="${message}"
         th:class="${'success'.equals(messageType)} ? 'message success' : 'message error'"
         th:text="${message}">
    </div>

    <!-- –î–û–ë–ê–í–ò–¢–¨ –≤ –Ω–∞—á–∞–ª–æ –∏–ª–∏ —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
    <div th:if="${buy != null}" class="payment-section">

        <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ -->
        <div th:if="${@buyService.getStepNameByBuyStepId(buy.buyStepId()) != null
                 and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–û–ø–ª–∞—á–µ–Ω')
                 and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–ó–∞–≤–µ—Ä—à–µ–Ω')}">

            <!-- –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã -->
            <form th:action="@{/buys/pay/{id}(id=${buy.id})}" method="post"
                  onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑? –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.');">

                <div class="payment-info">
                    <h4>üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h4>
                    <p>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞: <strong th:text="${'‚ÇΩ' + #numbers.formatDecimal(totalPrice, 0, 'COMMA', 2, 'POINT')}"></strong></p>
                    <small>–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ –∑–∞–∫–∞–∑–∞.</small>
                </div>

                <button type="submit" class="pay-button">
                    –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑
                </button>
            </form>
        </div>

        <!-- –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω -->
        <div th:if="${@buyService.getStepNameByBuyStepId(buy.buyStepId()) != null
                 and (@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–û–ø–ª–∞—á–µ–Ω')
                 or @buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–ó–∞–≤–µ—Ä—à–µ–Ω'))}">

            <div class="paid-badge">
                <strong>–ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω</strong>
                <p>–°—Ç–∞—Ç—É—Å: <span th:text="${@buyService.getStepNameByBuyStepId(buy.buyStepId())}"></span></p>
                <small>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ.</small>
            </div>
        </div>
    </div>


    <!-- ========== –ö–ù–û–ü–ö–ê "–î–û–ë–ê–í–ò–¢–¨ –¢–û–í–ê–†" ========== -->
    <!-- –ü–û–ö–ê–ó–´–í–ê–¢–¨ –¢–û–õ–¨–ö–û –ï–°–õ–ò –ó–ê–ö–ê–ó –ù–ï –û–ü–õ–ê–ß–ï–ù -->
    <div th:if="${buy != null
                 and @buyService.getStepNameByBuyStepId(buy.buyStepId()) != null
                 and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–û–ø–ª–∞—á–µ–Ω')
                 and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–ó–∞–≤–µ—Ä—à–µ–Ω')}"
         class="menu">
        <a th:href="@{'/buy-products/add/' + ${buyId}}" class="pay-button">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </a>
    </div>

    <!-- ========== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ó–ê–ö–ê–ó–ï ========== -->
    <div class="order-info" th:if="${buy != null}">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
            <span th:if="${buy.description}" th:text="${buy.description}"></span>
            <span th:unless="${buy.description}" class="no-data">–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è</span>
        </p>
        <p><strong>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞:</strong>
            <span class="total-price" th:text="${'‚ÇΩ' + #numbers.formatDecimal(totalPrice, 0, 'COMMA', 2, 'POINT')}"></span>
        </p>
        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π:</strong>
            <span th:text="${#lists.size(buyProductList)}"></span>
        </p>
    </div>

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>–¢–æ–≤–∞—Ä</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–ú–∏—Ñ–æ–ª–æ–≥–∏—è</th>
            <th>–¶–µ–Ω–∞ (—Ä—É–±.)</th>
            <th>–ö–æ–ª-–≤–æ</th>
            <th>–°—É–º–º–∞ (—Ä—É–±.)</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(buyProductList)}">
            <td colspan="8" class="no-data">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–º –∑–∞–∫–∞–∑–µ</td>
        </tr>
        <tr th:each="bp : ${buyProductList}">
            <td th:text="${bp.id}"></td>
            <td>
                <strong th:text="${bp.productName}"></strong>
                <div class="small-text">ID: <span th:text="${bp.productId}"></span></div>
            </td>
            <td th:text="${bp.productCategoryName} ?: '-'"></td>
            <td th:text="${bp.productMythologyName} ?: '-'"></td>
            <td th:text="${#numbers.formatDecimal(bp.productPrice, 1, 2)}"></td>
            <td th:text="${bp.amount}"></td>
            <td th:text="${#numbers.formatDecimal(bp.totalPrice, 1, 2)}"></td>
            <td th:if="${buy != null
                 and @buyService.getStepNameByBuyStepId(buy.buyStepId()) != null
                 and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–û–ø–ª–∞—á–µ–Ω')
                 and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–ó–∞–≤–µ—Ä—à–µ–Ω')}" class="actions">

                <a th:href="@{/buy-products/edit/{id}(id=${bp.id})}" class="btn-edit">–ò–∑–º–µ–Ω–∏—Ç—å</a>
                <form th:action="@{/buy-products/delete/{id}(id=${bp.id})}" method="post" style="display: inline;">
                    <button type="submit" class="btn-delete"
                            onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∑–∞–∫–∞–∑–∞?')">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </td>

            <td th:unless="${buy != null
               and @buyService.getStepNameByBuyStepId(buy.buyStepId()) != null
               and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–û–ø–ª–∞—á–µ–Ω')
               and !@buyService.getStepNameByBuyStepId(buy.buyStepId()).contains('–ó–∞–≤–µ—Ä—à–µ–Ω')}">
                <div class="paid-info">
                    <small>–ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω</small>
                    <br>
                    <small style="color: #888;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ</small>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
