<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Редактировать заказ - MythMastery</title>
  <link rel="stylesheet" th:href="@{/css/createUpdatePages.css}">
</head>
<body>
<div class="container">
  <a th:href="@{/buys}" class="btn btn-secondary">← Назад к списку</a>
  <h1>Редактировать заказ</h1>

  <div th:if="${message}"
       th:class="${'success'.equals(messageType)} ? 'message success' : 'message error'"
       th:text="${message}">
  </div>

  <form method="post" th:action="@{/buys/update/{id}(id=${buy.id})}">
    <div class="form-group">
      <label for="customerId">ID клиента *</label>
      <input type="number" id="customerId" name="customerId"
             th:value="${buy.customerId}" min="1" required>
    </div>

    <div class="form-group">
      <label>Статус заказа</label>

      <div style="background: #2d2d2d; padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #4a90e2;">
        <strong>Текущий статус:</strong>
        <span style="color: #4a90e2; font-weight: bold;"
              th:text="${currentStatusName}"></span>
        <br>
        <small style="color: #888;">
          ID шага покупки:
          <code th:text="${buy.buyStepId} ?: 'не задан'"></code>
        </small>
      </div>

      <label for="selectedStepId">Изменить статус на:</label>
      <select id="selectedStepId" name="selectedStepId" class="form-control">
        <option value="">-- Не изменять статус --</option>

        <option th:each="step : ${allSteps}"
                th:value="${step.id}"
                th:text="${step.name} + ' (' + ${step.description} + ')'">
        </option>
      </select>

      <small class="form-text">
        Выберите новый статус из списка. При сохранении будет создана связь с шагом покупки.
      </small>
    </div>

    <div class="form-group">
      <label for="description">Описание заказа</label>
      <textarea id="description" name="description" rows="3"
                th:text="${buy.description}"></textarea>
    </div>

    <div class="button-group">
      <button type="submit" class="btn btn-primary">Сохранить изменения</button>
      <a th:href="@{/buys}" class="btn btn-secondary">Отмена</a>
    </div>
  </form>
</div>
</body>
</html>
